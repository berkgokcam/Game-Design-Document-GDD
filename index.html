<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GDD Studio - Game Design Document Generator</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-gamepad"></i>
                    <span>GDD Studio</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <span class="nav-section-title">DOCUMENT</span>
                    <ul class="nav-list" id="documentSections">
                        <!-- Dynamically populated -->
                    </ul>
                </div>

                <div class="nav-section">
                    <span class="nav-section-title">TOOLS</span>
                    <ul class="nav-list">
                        <li class="nav-item" data-tool="chat">
                            <i class="fas fa-comments"></i>
                            <span>AI Chat</span>
                        </li>
                        <li class="nav-item" data-tool="diagrams">
                            <i class="fas fa-project-diagram"></i>
                            <span>Diagrams</span>
                        </li>
                        <li class="nav-item" data-tool="export">
                            <i class="fas fa-file-export"></i>
                            <span>Export / Import</span>
                        </li>
                    </ul>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="ollama-status" id="ollamaStatus">
                    <span class="status-dot"></span>
                    <span>Connecting to Ollama...</span>
                </div>
                <select id="modelSelect" class="model-select">
                    <option value="">Select Model...</option>
                </select>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <header class="top-bar">
                <div class="breadcrumb" id="breadcrumb">
                    <span>Home</span>
                </div>
                <div class="top-bar-actions">
                    <button class="btn btn-ghost" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="btn btn-primary" id="newProjectBtn">
                        <i class="fas fa-plus"></i>
                        New Project
                    </button>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content-wrapper">
                <!-- Welcome/Overview Panel -->
                <div class="panel welcome-panel" id="welcomePanel">
                    <div class="welcome-content">
                        <h1>üéÆ Welcome to GDD Studio</h1>
                        <p>AI-powered Game Design Document creation tool</p>

                        <div class="quick-start">
                            <h3>Quick Start</h3>
                            <div class="quick-start-grid">
                                <div class="quick-start-card" onclick="startNewProject()">
                                    <i class="fas fa-rocket"></i>
                                    <h4>New Project</h4>
                                    <p>Create a GDD from scratch</p>
                                </div>
                                <div class="quick-start-card" onclick="openChat()">
                                    <i class="fas fa-brain"></i>
                                    <h4>AI Brainstorm</h4>
                                    <p>Develop your ideas</p>
                                </div>
                                <div class="quick-start-card" onclick="triggerImport()">
                                    <i class="fas fa-file-import"></i>
                                    <h4>Import Project</h4>
                                    <p>Load from JSON backup</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- GDD Editor Panel -->
                <div class="panel gdd-panel hidden" id="gddPanel">
                    <div class="gdd-header">
                        <input type="text" class="gdd-title-input" id="gddTitle" placeholder="Game Title...">
                        <div class="gdd-meta">
                            <span class="meta-item"><i class="fas fa-calendar"></i> <span
                                    id="lastUpdated">-</span></span>
                            <span class="meta-item"><i class="fas fa-file-word"></i> <span id="wordCount">0</span>
                                words</span>
                        </div>
                    </div>

                    <div class="gdd-sections" id="gddSections">
                        <!-- GDD sections will be rendered here -->
                    </div>
                </div>

                <!-- Chat Panel -->
                <div class="panel chat-panel hidden" id="chatPanel">
                    <div class="chat-header">
                        <h2><i class="fas fa-robot"></i> AI Assistant</h2>
                        <div class="chat-actions">
                            <button class="btn btn-ghost btn-sm" onclick="clearChat()">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    <div class="chat-messages" id="chatMessages">
                        <div class="chat-message assistant">
                            <div class="message-avatar"><i class="fas fa-robot"></i></div>
                            <div class="message-content">
                                <p>Hello! I'm the GDD Studio AI assistant. I can help you create your game design
                                    document.</p>
                                <p>Tell me about your game idea and I'll automatically generate all the necessary
                                    sections:</p>
                                <ul>
                                    <li>üìù Game Overview & Concept</li>
                                    <li>üéÆ Gameplay Mechanics</li>
                                    <li>üìñ Story & Characters</li>
                                    <li>üó∫Ô∏è World & Level Design</li>
                                    <li>üé® Art Style</li>
                                    <li>üîä Sound Design</li>
                                    <li>‚öôÔ∏è Technical Requirements</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="chat-input-area">
                        <div class="chat-suggestions" id="chatSuggestions">
                            <button class="suggestion-chip"
                                onclick="useSuggestion('I want to make a roguelike dungeon crawler game')">
                                üó°Ô∏è Roguelike Dungeon
                            </button>
                            <button class="suggestion-chip" onclick="useSuggestion('A casual puzzle game for mobile')">
                                üß© Casual Puzzle
                            </button>
                            <button class="suggestion-chip" onclick="useSuggestion('An open world survival game')">
                                üèïÔ∏è Survival Game
                            </button>
                        </div>
                        <div class="chat-input-wrapper">
                            <textarea id="chatInput" placeholder="Describe your game idea..." rows="1"></textarea>
                            <button class="btn btn-primary send-btn" id="sendBtn" onclick="sendMessage()">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Diagram Panel -->
                <div class="panel diagram-panel hidden" id="diagramPanel">
                    <div class="diagram-header">
                        <h2><i class="fas fa-project-diagram"></i> Diagrams</h2>
                        <div class="diagram-actions">
                            <select id="diagramType" class="diagram-select">
                                <optgroup label="Game Design">
                                    <option value="gameloop">üîÑ Game Loop</option>
                                    <option value="mechanics">‚öôÔ∏è Mechanic Relations</option>
                                    <option value="progression">üìà Progression System</option>
                                    <option value="ui-flow">üì± UI Flow</option>
                                </optgroup>
                                <optgroup label="Technical">
                                    <option value="class-diagram">üèóÔ∏è Class Diagram</option>
                                    <option value="state-diagram">üîÄ State Diagram</option>
                                    <option value="er-diagram">üóÑÔ∏è ER Diagram</option>
                                    <option value="sequence">üìã Sequence Diagram</option>
                                </optgroup>
                                <optgroup label="Planning">
                                    <option value="mindmap">üß† Mind Map</option>
                                    <option value="timeline">üìÖ Timeline</option>
                                </optgroup>
                                <option value="custom">‚úèÔ∏è Custom Diagram</option>
                            </select>
                            <button class="btn btn-primary" id="generateDiagramBtn" onclick="generateDiagram()">
                                <i class="fas fa-magic"></i> Generate
                            </button>
                        </div>
                    </div>

                    <!-- Custom Prompt for Diagrams -->
                    <div class="diagram-prompt-area">
                        <div class="diagram-prompt-wrapper">
                            <i class="fas fa-lightbulb diagram-prompt-icon"></i>
                            <textarea id="diagramCustomPrompt" class="diagram-prompt-input"
                                placeholder="Describe what to generate or modify... (e.g. 'Add inventory system nodes', 'Add a Pause state between Playing and GameOver', 'Remove the tutorial section')"
                                rows="2"></textarea>
                        </div>
                    </div>

                    <div class="diagram-content">
                        <div class="diagram-main-area">
                            <div class="diagram-preview-wrapper">
                                <div class="diagram-zoom-controls">
                                    <button class="btn btn-ghost btn-sm" onclick="diagramZoom('in')" title="Zoom In">
                                        <i class="fas fa-search-plus"></i>
                                    </button>
                                    <button class="btn btn-ghost btn-sm" onclick="diagramZoom('out')" title="Zoom Out">
                                        <i class="fas fa-search-minus"></i>
                                    </button>
                                    <button class="btn btn-ghost btn-sm" onclick="diagramZoom('reset')"
                                        title="Reset Zoom">
                                        <i class="fas fa-compress-arrows-alt"></i>
                                    </button>
                                    <span class="diagram-zoom-level" id="diagramZoomLevel">100%</span>
                                </div>
                                <div class="diagram-preview" id="diagramPreview">
                                    <div class="mermaid" id="mermaidDiagram">
                                        graph TD
                                        A[Start] --> B{Is it working?}
                                        B -->|Yes| C[Great!]
                                        B -->|No| D[Debug]
                                        D --> A
                                    </div>
                                </div>
                            </div>
                            <div class="diagram-code">
                                <div class="diagram-code-header">
                                    <label>Mermaid Code</label>
                                    <div class="diagram-code-actions">
                                        <button class="btn btn-ghost btn-sm" onclick="updateDiagram()"
                                            title="Refresh Preview">
                                            <i class="fas fa-sync"></i>
                                        </button>
                                        <button class="btn btn-ghost btn-sm" onclick="saveDiagram()"
                                            title="Save Diagram">
                                            <i class="fas fa-bookmark"></i>
                                        </button>
                                        <button class="btn btn-ghost btn-sm" onclick="exportDiagramSVG()"
                                            title="Export as SVG">
                                            <i class="fas fa-download"></i>
                                        </button>
                                    </div>
                                </div>
                                <textarea id="diagramCode" placeholder="Write your Mermaid diagram code here...">graph TD
    A[Start] --> B{Is it working?}
    B -->|Yes| C[Great!]
    B -->|No| D[Debug]
    D --> A</textarea>
                            </div>
                        </div>
                        <div class="diagram-sidebar">
                            <div class="diagram-sidebar-header">
                                <h4><i class="fas fa-history"></i> Saved Diagrams</h4>
                            </div>
                            <div class="diagram-history-list" id="diagramHistoryList">
                                <p class="diagram-history-empty"><i class="fas fa-folder-open"></i> No saved diagrams
                                    yet</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Export & Import Panel -->
                <div class="panel export-panel hidden" id="exportPanel">
                    <div class="export-header">
                        <h2><i class="fas fa-file-export"></i> Export & Import</h2>
                    </div>

                    <div class="export-import-container">
                        <!-- Export Section -->
                        <div class="export-section">
                            <h3 class="section-label"><i class="fas fa-upload"></i> Export</h3>
                            <div class="export-options">
                                <div class="export-card" onclick="exportAs('markdown')">
                                    <i class="fab fa-markdown"></i>
                                    <h4>Markdown</h4>
                                    <p>Obsidian, Notion compatible</p>
                                </div>
                                <div class="export-card" onclick="exportAs('html')">
                                    <i class="fas fa-code"></i>
                                    <h4>HTML</h4>
                                    <p>Web preview</p>
                                </div>
                                <div class="export-card" onclick="exportAs('pdf')">
                                    <i class="fas fa-file-pdf"></i>
                                    <h4>PDF</h4>
                                    <p>Print ready</p>
                                </div>
                                <div class="export-card" onclick="exportAs('json')">
                                    <i class="fas fa-database"></i>
                                    <h4>JSON</h4>
                                    <p>Full backup with all data</p>
                                </div>
                            </div>
                        </div>

                        <!-- Import Section -->
                        <div class="import-section">
                            <h3 class="section-label"><i class="fas fa-download"></i> Import</h3>
                            <div class="import-drop-zone" id="importDropZone">
                                <div class="import-drop-content">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <h4>Import GDD Project</h4>
                                    <p>Drag & drop a file here, or click to browse</p>
                                    <button class="btn btn-primary" onclick="triggerImport()">
                                        <i class="fas fa-folder-open"></i> Choose File
                                    </button>
                                </div>
                            </div>
                            <p class="import-hint">
                                <i class="fas fa-info-circle"></i>
                                Supports JSON, Markdown (.md), and HTML files. Your current project will be replaced.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Side Panel (Context/AI Suggestions) -->
        <aside class="side-panel" id="sidePanel">
            <div class="side-panel-header">
                <h3>AI Suggestions</h3>
                <button class="btn btn-ghost btn-sm" onclick="toggleSidePanel()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="side-panel-content" id="sidePanelContent">
                <div class="suggestion-card">
                    <h4>üí° Tip</h4>
                    <p>Select a section from the left menu and ask AI to generate content for it.</p>
                </div>
            </div>
        </aside>
    </div>

    <!-- New Project Modal -->
    <div class="modal hidden" id="newProjectModal">
        <div class="modal-backdrop" onclick="closeModal('newProjectModal')"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create New Project</h2>
                <button class="btn btn-ghost" onclick="closeModal('newProjectModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Game Title</label>
                    <input type="text" id="newProjectName" placeholder="Your game's name...">
                </div>
                <div class="form-group">
                    <label>Genre <span class="form-hint">(select multiple or add custom)</span></label>
                    <div class="genre-chips" id="genreChips">
                        <button type="button" class="genre-chip" data-genre="Action">üéØ Action</button>
                        <button type="button" class="genre-chip" data-genre="Adventure">üó∫Ô∏è Adventure</button>
                        <button type="button" class="genre-chip" data-genre="RPG">‚öîÔ∏è RPG</button>
                        <button type="button" class="genre-chip" data-genre="Puzzle">üß© Puzzle</button>
                        <button type="button" class="genre-chip" data-genre="Simulation">üèóÔ∏è Simulation</button>
                        <button type="button" class="genre-chip" data-genre="Strategy">‚ôüÔ∏è Strategy</button>
                        <button type="button" class="genre-chip" data-genre="Casual">üé≤ Casual</button>
                        <button type="button" class="genre-chip" data-genre="Horror">üëª Horror</button>
                        <button type="button" class="genre-chip" data-genre="Platformer">üèÉ Platformer</button>
                        <button type="button" class="genre-chip" data-genre="Racing">üèéÔ∏è Racing</button>
                        <button type="button" class="genre-chip" data-genre="Fighting">ü•ä Fighting</button>
                        <button type="button" class="genre-chip" data-genre="Sports">‚öΩ Sports</button>
                        <button type="button" class="genre-chip" data-genre="Sandbox">üåç Sandbox</button>
                        <button type="button" class="genre-chip" data-genre="Survival">üèïÔ∏è Survival</button>
                        <button type="button" class="genre-chip" data-genre="Shooter">üî´ Shooter</button>
                        <button type="button" class="genre-chip" data-genre="Stealth">ü•∑ Stealth</button>
                    </div>
                    <div class="genre-custom-input">
                        <input type="text" id="genreCustomInput" placeholder="Type custom genre and press Enter...">
                    </div>
                    <div class="genre-selected-tags" id="genreSelectedTags"></div>
                </div>
                <div class="form-group">
                    <label>Short Description</label>
                    <textarea id="newProjectDesc" rows="3" placeholder="Briefly describe your game..."></textarea>
                </div>
                <div class="form-group">
                    <label>Platforms</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" value="pc" checked> PC
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="mobile"> Mobile
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="console"> Console
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" value="web"> Web
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeModal('newProjectModal')">Cancel</button>
                <button class="btn btn-primary" onclick="createProject()">
                    <i class="fas fa-plus"></i> Create
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="app.js"></script>
</body>

</html>